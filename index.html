<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Removido título para iOS NÃO sobrescrever o título da notificação -->
  <title></title>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 500px;
      margin: 20px auto;
      padding: 20px;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin: 12px 0;
    }

    button {
      width: 100%;
      padding: 14px;
      background: #000;
      color: #fff;
      font-size: 18px;
      border: none;
      cursor: pointer;
      margin-top: 18px;
      border-radius: 6px;
    }

    h2 {
      margin-bottom: 25px;
    }
  </style>
</head>
<body>

  <h2>Gerador de Notificações iPhone</h2>

  <label>Presets</label>
  <select id="presetSelect" onchange="applyPreset()">
    <option value="">Escolher...</option>
    <option value="pix">Transferência Recebida - R$19.000</option>
    <option value="bank">Compra Aprovada</option>
    <option value="insta">DM do Instagram</option>
  </select>

  <label>Título</label>
  <input id="titleInput" placeholder="Ex: Instagram, Pix, Banco..." />

  <label>Corpo da Notificação</label>
  <input id="bodyInput" placeholder="Ex: Você recebeu R$ 1.200,00" />

  <label>Ícone</label>
  <select id="iconSelect">
    <option value="/icon1.png">Nubank Icon</option>
    <option value="/icon2.png">PicPay Icon</option>
    <option value="/icon3.png">Instagram Icon</option>
  </select>

  <label>Quantas notificações?</label>
  <input id="amountInput" type="number" value="1" min="1" />

  <label>Tempo entre notificações (ms)</label>
  <input id="delayInput" type="number" value="1000" />

  <button onclick="requestPermission()">Permitir Notificações</button>

  <button onclick="sendCustom()">Gerar Notificações</button>

  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/sw.js");
    }

    function requestPermission() {
      Notification.requestPermission().then(p => {
        alert(p === "granted" ? "Permissão concedida!" : "Permissão negada!");
      });
    }

    function applyPreset() {
      const preset = document.getElementById("presetSelect").value;

      if (preset === "pix") {
        document.getElementById("titleInput").value = "Transferência Recebida";
        document.getElementById("bodyInput").value = "Recebemos sua transferência de R$ 19.000,00.";
      }

      if (preset === "bank") {
        document.getElementById("titleInput").value = "Compra aprovada";
        document.getElementById("bodyInput").value = "Sua compra de R$ 1.299,99 foi aprovada.";
      }

      if (preset === "insta") {
        document.getElementById("titleInput").value = "Instagram";
        document.getElementById("bodyInput").value = "Novo pedido de mensagem.";
      }
    }

    function sendCustom() {
      const title = document.getElementById("titleInput").value;
      const body = document.getElementById("bodyInput").value;
      const icon = document.getElementById("iconSelect").value;
      const total = parseInt(document.getElementById("amountInput").value);
      const delay = parseInt(document.getElementById("delayInput").value);

      if (!title || !body) {
        alert("Preencha título e corpo!");
        return;
      }

      let count = 0;
      const loop = setInterval(() => {
        navigator.serviceWorker.ready.then(reg => {
          reg.showNotification(title, {
            body: body,
            icon: icon,
            badge: icon // força iOS a usar esse ícone
          });
        });

        count++;
        if (count >= total) clearInterval(loop);
      }, delay);
    }
  </script>

</body>
</html>
